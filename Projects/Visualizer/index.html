<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timeline Visualizer | 项目时间线可视化</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Vue.js CDN - 多个备用源 -->
    <script>
        // Vue.js CDN列表（按优先级排序，包含多个备用源）
        const vueCDNs = [
            'https://unpkg.com/vue@3.2.45/dist/vue.global.prod.js',  // 优先使用unpkg（通常更稳定）
            'https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js',
            'https://fastly.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js',
            'https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.45/vue.global.prod.min.js',
            'https://cdn.bootcdn.net/ajax/libs/vue/3.2.45/vue.global.prod.min.js',  // 国内CDN
            'https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js',  // 七牛云CDN
            'https://gcore.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js'  // Gcore CDN
        ];

        let currentCDNIndex = 0;

        // 加载Vue.js的函数
        function loadVue(cdnIndex = 0) {
            if (cdnIndex >= vueCDNs.length) {
                // 所有CDN都失败了
                console.error('所有Vue.js CDN都加载失败！');
                showVueError();
                return;
            }

            const script = document.createElement('script');
            script.src = vueCDNs[cdnIndex];

            script.onload = function() {
                console.log('✓ Vue.js脚本加载成功，来源:', vueCDNs[cdnIndex]);
                // 等待一小段时间确保Vue已定义
                setTimeout(() => {
                    if (typeof Vue !== 'undefined') {
                        console.log('✓ Vue对象已定义，版本:', Vue.version || '未知');
                        // Vue加载成功，不继续加载
                        return;
                    } else {
                        console.warn('Vue对象未定义，尝试下一个CDN');
                        loadVue(cdnIndex + 1);
                    }
                }, 200);
            };

            script.onerror = function() {
                console.warn('CDN加载失败:', vueCDNs[cdnIndex]);
                // 尝试下一个CDN
                loadVue(cdnIndex + 1);
            };

            document.head.appendChild(script);
        }

        // 显示Vue加载错误页面
        window.showVueError = function() {
            if (document.body) {
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; gap: 20px; padding: 20px; text-align: center; background: #f5f7fb;">
                        <div style="font-size: 64px;">⚠️</div>
                        <h1 style="color: #f94144; margin: 0;">Vue.js加载失败</h1>
                        <p style="font-size: 16px; color: #666; max-width: 600px;">无法加载Vue.js框架，可能的原因：</p>
                        <ul style="text-align: left; max-width: 500px; color: #666; line-height: 1.8;">
                            <li>网络连接问题</li>
                            <li>CDN服务不可用</li>
                            <li>防火墙或代理设置阻止</li>
                            <li>地区限制</li>
                        </ul>
                        <p style="color: #666; font-weight: 600;">建议：</p>
                        <ul style="text-align: left; max-width: 500px; color: #666; line-height: 1.8;">
                            <li>检查网络连接</li>
                            <li>刷新页面重试</li>
                            <li>使用VPN或更换网络</li>
                            <li>联系网站管理员</li>
                        </ul>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #4361ee; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3); transition: all 0.3s;">
                            刷新页面
                        </button>
                    </div>
                `;
            }
        };

        // 开始加载Vue.js
        loadVue(0);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.36.3/dist/apexcharts.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.36.3/dist/apexcharts.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --bg-color: #f5f7fb;
            --card-bg: #ffffff;
            --border-color: #e1e5eb;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--dark);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            isolation: isolate;
        }

        /* 头部样式 */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            z-index: 100;
            position: relative;
            isolation: isolate;
            flex-shrink: 0;
            height: 70px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 1.75rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .health-score {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .health-score:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .health-score.good {
            background: rgba(76, 201, 240, 0.3);
        }

        .health-score.warning {
            background: rgba(247, 37, 133, 0.3);
        }

        /* 主内容区 */
        .main-content {
            display: flex;
            flex: 1;
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
            padding: 1rem;
            gap: 1rem;
            position: relative;
            isolation: isolate;
            height: calc(100vh - 70px);
            overflow: hidden;
        }

        /* 侧边栏 */
        .sidebar {
            width: 280px;
            min-width: 280px;
            max-width: 280px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            isolation: isolate;
            overflow-y: auto;
            height: 100%;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 1rem;
            position: relative;
            isolation: isolate;
            transition: box-shadow 0.3s ease, transform 0.2s ease;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card h2 i {
            color: var(--primary);
        }

        /* 视图切换器 */
        .view-switcher {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .view-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .view-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .view-btn.active::before {
            transform: scaleY(1);
        }

        .view-btn:hover {
            background: #f0f4ff;
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .view-btn.active {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.2);
        }

        .view-btn i {
            width: 20px;
            text-align: center;
        }

        /* 项目列表 */
        .project-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .project-item {
            padding: 0.75rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            isolation: isolate;
        }

        .project-item:hover {
            background: #eef2ff;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.15);
        }

        .project-item.active {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            border-left-color: var(--secondary);
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.2);
        }

        .project-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .project-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .stat-card {
            text-align: center;
            padding: 0.75rem;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--gray);
        }

        /* 内容区域 */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            isolation: isolate;
            min-width: 0;
            overflow: hidden;
            height: 100%;
        }

        /* 工具栏 */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(63, 55, 201, 0.05));
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .toolbar h2 {
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .toolbar-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            position: relative;
            isolation: isolate;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--dark);
        }

        .btn-outline:hover {
            background: #f8f9fa;
        }

        /* 视图容器 */
        .view-container {
            flex: 1;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            isolation: isolate;
            min-height: 0;
            height: 100%;
        }

        .view-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .view-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .view-actions-group {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding-right: 0.5rem;
            margin-right: 0.5rem;
            border-right: 1px solid var(--border-color);
        }

        .view-actions-group:last-child {
            border-right: none;
            padding-right: 0;
            margin-right: 0;
        }

        .btn-icon {
            padding: 0.5rem 0.75rem;
            min-width: auto;
        }

        .btn-icon i {
            margin: 0;
        }

        .btn-calendar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
        }

        .view-content {
            flex: 1;
            padding: 1rem;
            overflow: auto;
            min-height: 0;
        }

        /* 甘特图样式 */
        .gantt-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            overflow: auto;
        }

        .gantt-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .gantt-sidebar {
            background: #f8f9fa;
            border-right: 1px solid var(--border-color);
        }

        .gantt-header {
            padding: 0.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.1));
            border-bottom: 2px solid var(--border-color);
            color: var(--primary);
        }

        .gantt-task-list {
            display: flex;
            flex-direction: column;
        }

        .gantt-task-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .gantt-task-item:hover {
            background: #f0f4ff;
            padding-left: 1rem;
        }

        .gantt-task-item:active {
            background: #e6eeff;
        }

        .gantt-task-item.selected {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            border-left: 3px solid var(--primary);
            padding-left: calc(0.75rem - 3px);
        }

        .gantt-task-item:last-child {
            border-bottom: none;
        }

        .task-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .gantt-chart-area {
            position: relative;
            overflow: auto;
        }

        .gantt-timeline {
            display: flex;
            height: 40px;
            border-bottom: 1px solid var(--border-color);
        }

        .gantt-time-unit {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--border-color);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .gantt-time-unit:last-child {
            border-right: none;
        }

        .gantt-bars {
            position: relative;
            height: calc(100% - 40px);
        }

        .gantt-bar {
            position: absolute;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding: 0 0.75rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gantt-bar:hover {
            filter: brightness(1.15);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .gantt-bar-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        /* 看板样式 */
        .kanban-container {
            display: flex;
            gap: 1rem;
            height: 100%;
            min-height: 400px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .kanban-column {
            flex: 1;
            min-width: 280px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            max-height: 100%;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .kanban-column:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .kanban-header {
            padding: 1rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(63, 55, 201, 0.05));
            border-radius: 10px 10px 0 0;
        }

        .kanban-task-count {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(67, 97, 238, 0.3);
            transition: all 0.3s ease;
        }

        .kanban-task-count:hover {
            transform: scale(1.1);
        }

        .kanban-tasks {
            flex: 1;
            padding: 0.75rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .kanban-task {
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .kanban-task:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.12);
            transform: translateY(-2px);
            border-left-color: var(--primary);
        }

        .kanban-task.selected {
            border: 2px solid var(--primary);
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .kanban-task-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .kanban-task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--gray);
        }

        /* 日历视图 */
        .calendar-container {
            height: 100%;
            min-height: 400px;
            overflow: auto;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border-color);
            border: 1px solid var(--border-color);
        }

        .calendar-day-header {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.1));
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .calendar-day:hover {
            background: #f0f4ff;
            border-color: var(--primary);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            border: 2px solid var(--primary);
        }

        .calendar-day.other-month {
            background: #f8f9fa;
            color: var(--gray);
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .calendar-event {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-event:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
            position: relative;
        }

        /* 资源视图 */
        .resource-container {
            height: 100%;
            min-height: 400px;
            overflow: auto;
        }

        .resource-chart {
            height: 300px;
            margin-bottom: 2rem;
        }

        .resource-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .resource-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
        }

        .resource-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(67, 97, 238, 0.3);
            transition: all 0.3s ease;
        }

        .resource-item:hover .resource-avatar {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.4);
        }

        .resource-info {
            flex: 1;
        }

        .resource-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .resource-skills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .skill-tag {
            background: linear-gradient(135deg, #e9ecef, #f8f9fa);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .skill-tag:hover {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .resource-load {
            text-align: right;
        }

        .load-value {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .load-label {
            font-size: 0.75rem;
            color: var(--gray);
        }

        /* 详情面板 */
        .detail-panel {
            width: 320px;
            min-width: 320px;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            isolation: isolate;
            overflow-y: auto;
            height: 100%;
        }

        .task-detail {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .task-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .task-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .priority-high {
            background: #ffe6e6;
            color: #d32f2f;
        }

        .priority-medium {
            background: #fff4e6;
            color: #f57c00;
        }

        .priority-low {
            background: #e6f4ea;
            color: #388e3c;
        }

        .task-meta {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
        }

        .meta-label {
            color: var(--gray);
        }

        .meta-value {
            font-weight: 500;
        }

        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #3fd4f0);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 1px 3px rgba(76, 201, 240, 0.3);
        }

        .task-dependencies {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dependency-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .dependency-item:hover {
            background: linear-gradient(135deg, #e6eeff, #f0f4ff);
            transform: translateX(4px);
        }

        .dependency-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-completed {
            background: var(--success);
        }

        .status-in-progress {
            background: var(--warning);
        }

        .status-not-started {
            background: var(--gray);
        }

        /* 模态框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s;
            isolation: isolate;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            isolation: isolate;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            padding: 0.5rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            transform: translateY(-1px);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 1rem;
        }

        /* 加载状态 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 通知提示 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 2000;
            animation: slideInRight 0.3s;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        /* 甘特图优化 */
        .gantt-time-unit {
            min-width: 60px;
        }

        /* 可拖拽任务样式 */
        .kanban-task.dragging {
            opacity: 0.5;
        }

        .kanban-column.drag-over {
            background: #e6eeff;
        }

        /* 风险列表样式 */
        .risk-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .risk-item {
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid var(--gray);
        }

        .risk-item.high {
            border-left-color: var(--danger);
        }

        .risk-item.medium {
            border-left-color: var(--warning);
        }

        .risk-item.low {
            border-left-color: var(--success);
        }

        .risk-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .risk-description {
            font-size: 0.875rem;
            color: var(--gray);
        }

        /* 深色主题 */
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --dark: #ffffff;
            --light: #3a3a3a;
            --border-color: #404040;
            --gray: #999999;
        }

        [data-theme="dark"] body {
            background-color: var(--bg-color);
            color: var(--dark);
        }

        [data-theme="dark"] .card {
            background: var(--card-bg);
            color: var(--dark);
        }

        [data-theme="dark"] .gantt-sidebar {
            background: #252525;
        }

        [data-theme="dark"] .gantt-header {
            background: #333333;
        }

        [data-theme="dark"] .kanban-column {
            background: #252525;
        }

        [data-theme="dark"] .kanban-task {
            background: var(--card-bg);
        }

        [data-theme="dark"] .calendar-day {
            background: var(--card-bg);
        }

        [data-theme="dark"] .calendar-day.other-month {
            background: #252525;
        }

        /* 设置面板 */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--card-bg);
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            transition: right 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            padding: 2rem;
            isolation: isolate;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(2px);
            z-index: 998;
            display: none;
            isolation: isolate;
        }

        .settings-overlay.active {
            display: block;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar, .detail-panel {
                width: 100%;
            }

            .sidebar {
                order: 2;
            }

            .content-area {
                order: 1;
            }

            .detail-panel {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .toolbar {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .gantt-grid {
                grid-template-columns: 1fr;
            }

            .gantt-sidebar {
                display: none;
            }

            .kanban-container {
                flex-direction: column;
                height: auto;
            }

            .calendar-grid {
                grid-template-columns: 1fr;
            }

            .calendar-day-header {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- 头部 -->
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-project-diagram"></i>
                    <h1>Project Timeline Visualizer</h1>
                </div>
                <div class="health-score" :class="projectHealthClass">
                    <i class="fas fa-heartbeat"></i>
                    <span>项目健康度: {{ projectHealth }}%</span>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 侧边栏 -->
            <div class="sidebar">
                <div class="card">
                    <h2><i class="fas fa-th"></i> 视图切换</h2>
                    <div class="view-switcher">
                        <button
                            v-for="view in views"
                            :key="view.id"
                            class="view-btn"
                            :class="{ active: currentView === view.id }"
                            @click="switchView(view.id)"
                        >
                            <i :class="view.icon"></i>
                            <span>{{ view.name }}</span>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="margin: 0;"><i class="fas fa-folder-open"></i> 项目列表</h2>
                        <button class="btn btn-primary" @click="showProjectModal()" style="padding: 0.4rem 0.75rem; font-size: 0.875rem;" title="创建新项目">
                            <i class="fas fa-plus"></i> 新建
                        </button>
                    </div>
                    <div class="project-list">
                        <div
                            v-for="project in projects"
                            :key="project.id"
                            class="project-item"
                            :class="{ active: currentProject?.id === project.id }"
                            @click="selectProject(project)"
                        >
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div style="flex: 1;">
                            <div class="project-name">{{ project.name }}</div>
                            <div class="project-meta">
                                <span>{{ project.tasks.length }} 个任务</span>
                                <span>{{ formatDate(project.startDate) }}</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button class="btn btn-outline" @click.stop="showProjectModal(project)" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" title="编辑项目">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline" @click.stop="deleteProject(project)" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; color: var(--danger);" title="删除项目">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-chart-bar"></i> 项目统计</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">{{ completedTasks }}/{{ totalTasks }}</div>
                            <div class="stat-label">已完成任务</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ overdueTasks }}</div>
                            <div class="stat-label">逾期任务</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ teamMembers.length }}</div>
                            <div class="stat-label">团队成员</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ Math.round(projectDuration) }}</div>
                            <div class="stat-label">项目天数</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内容区域 -->
            <div class="content-area">
                <div class="toolbar">
                    <h2>{{ currentProject?.name || '请选择项目' }} - {{ currentViewName }}</h2>
                    <div class="toolbar-actions">
                        <button class="btn btn-outline" @click="showSettings = !showSettings" title="设置">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn btn-outline" @click="toggleTheme" :title="theme === 'light' ? '切换到深色模式' : '切换到浅色模式'">
                            <i :class="theme === 'light' ? 'fas fa-moon' : 'fas fa-sun'"></i>
                        </button>
                        <button class="btn btn-outline" @click="exportData">
                            <i class="fas fa-download"></i> 导出
                        </button>
                        <button class="btn btn-outline" @click="shareProject">
                            <i class="fas fa-share"></i> 分享
                        </button>
                        <button class="btn btn-primary" @click="showTaskModal()" v-if="currentProject" title="添加新任务">
                            <i class="fas fa-plus"></i> 添加任务
                        </button>
                        <button class="btn btn-primary" @click="showProjectModal()" v-else title="请先创建项目">
                            <i class="fas fa-folder-plus"></i> 创建项目
                        </button>
                    </div>
                </div>

                <!-- 搜索和筛选栏 -->
                <div v-if="currentProject" class="card" style="padding: 0.75rem 1rem; flex-shrink: 0;">
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center;">
                        <div style="flex: 1; min-width: 200px;">
                            <input
                                type="text"
                                class="form-input search-input"
                                v-model="searchQuery"
                                placeholder="搜索任务..."
                                style="width: 100%;"
                            >
                        </div>
                        <select class="form-select" v-model="filterStatus" style="width: 120px;">
                            <option value="all">全部状态</option>
                            <option value="not-started">未开始</option>
                            <option value="in-progress">进行中</option>
                            <option value="completed">已完成</option>
                        </select>
                        <select class="form-select" v-model="filterPriority" style="width: 120px;">
                            <option value="all">全部优先级</option>
                            <option value="high">高优先级</option>
                            <option value="medium">中优先级</option>
                            <option value="low">低优先级</option>
                        </select>
                        <select class="form-select" v-model="filterAssignee" style="width: 120px;">
                            <option value="all">全部负责人</option>
                            <option v-for="member in teamMembers" :key="member.id" :value="member.name">
                                {{ member.name }}
                            </option>
                        </select>
                        <button class="btn btn-outline" @click="clearFilters" v-if="searchQuery || filterStatus !== 'all' || filterPriority !== 'all' || filterAssignee !== 'all'">
                            <i class="fas fa-times"></i> 清除
                        </button>
                    </div>
                </div>

                <!-- 批量操作栏 -->
                <div v-if="showBulkActions && selectedTasks.length > 0" class="card" style="padding: 0.75rem 1rem; background: #e6eeff; border-left: 4px solid var(--primary); flex-shrink: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>已选择 {{ selectedTasks.length }} 个任务</strong>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-outline" @click="bulkUpdateStatus('not-started')">
                                设为未开始
                            </button>
                            <button class="btn btn-outline" @click="bulkUpdateStatus('in-progress')">
                                设为进行中
                            </button>
                            <button class="btn btn-outline" @click="bulkUpdateStatus('completed')">
                                设为已完成
                            </button>
                            <button class="btn btn-outline" @click="bulkDeleteTasks()" style="color: var(--danger);">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                            <button class="btn btn-outline" @click="selectedTasks = []; showBulkActions = false;">
                                取消选择
                            </button>
                        </div>
                    </div>
                </div>

                <div class="view-container">
                    <div class="view-header">
                        <h3>{{ currentViewName }}视图</h3>
                        <div class="view-actions">
                            <div class="view-actions-group" v-if="currentView === 'gantt' || currentView === 'kanban' || currentView === 'calendar'">
                                <button class="btn btn-outline btn-icon" @click="printView" title="打印">
                                    <i class="fas fa-print"></i>
                            </button>
                                <button class="btn btn-outline btn-icon" @click="exportToPDF" title="导出PDF">
                                    <i class="fas fa-file-pdf"></i>
                            </button>
                            </div>
                            <button class="btn btn-outline" v-if="currentView === 'gantt'" @click="toggleFullscreen" title="全屏">
                                <i class="fas fa-expand"></i> 全屏
                            </button>
                            <button class="btn btn-outline btn-calendar" v-if="currentView === 'calendar'" @click="showCalendarPicker = !showCalendarPicker" title="选择月份">
                                <i class="fas fa-calendar-alt"></i>
                                <span>{{ currentMonth }} {{ currentYear }}</span>
                            </button>
                        </div>
                    </div>

                    <div class="view-content">
                        <!-- 甘特图视图 -->
                        <div v-if="currentView === 'gantt'" class="gantt-container">
                            <div v-if="!currentProject" class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <p>请先选择一个项目</p>
                            </div>
                            <div v-else-if="currentProject.tasks.length === 0" class="empty-state">
                                <i class="fas fa-tasks"></i>
                                <p>当前项目没有任务，请添加任务</p>
                                <button class="btn btn-primary" @click="showTaskModal()" style="margin-top: 1rem;">
                                    <i class="fas fa-plus"></i> 添加第一个任务
                                </button>
                            </div>
                            <div v-else class="gantt-grid">
                                <div class="gantt-sidebar">
                                    <div class="gantt-header">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>任务</span>
                                            <span style="font-size: 0.75rem; color: var(--gray); font-weight: normal;">{{ filteredTasks.length }} 个</span>
                                        </div>
                                    </div>
                                    <div class="gantt-task-list">
                                        <div
                                            v-for="task in filteredTasks"
                                            :key="task.id"
                                            class="gantt-task-item"
                                            @click="selectTask(task)"
                                            @dblclick="openEditTaskModal(task)"
                                            :class="{ 'selected': selectedTask && selectedTask.id === task.id }"
                                        >
                                            <div class="task-color" :style="{ backgroundColor: getPriorityColor(task.priority) }"></div>
                                            <span>{{ task.name }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="gantt-chart-area">
                                    <div class="gantt-timeline">
                                        <div v-for="(day, index) in timelineDays" :key="day.getTime() || index" class="gantt-time-unit">
                                            {{ formatTimelineDate(day) }}
                                        </div>
                                    </div>
                                    <div class="gantt-bars">
                                        <div
                                            v-for="task in filteredTasks"
                                            :key="task.id"
                                            class="gantt-bar"
                                            :style="{
                                                left: calculateTaskPosition(task.startDate) + '%',
                                                width: calculateTaskWidth(task.startDate, task.endDate) + '%',
                                                top: (filteredTasks.indexOf(task) * 40) + 'px',
                                                backgroundColor: getPriorityColor(task.priority)
                                            }"
                                            @click="selectTask(task)"
                                            @dblclick="openEditTaskModal(task)"
                                        >
                                            <div class="gantt-bar-progress" :style="{ width: task.progress + '%' }"></div>
                                            <span>{{ task.name }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 看板视图 -->
                        <div v-if="currentView === 'kanban'" class="kanban-container">
                            <div v-if="!currentProject" class="empty-state" style="width: 100%;">
                                <i class="fas fa-folder-open"></i>
                                <p>请先选择一个项目</p>
                            </div>
                            <div v-else-if="currentProject.tasks.length === 0" class="empty-state" style="width: 100%;">
                                <i class="fas fa-columns"></i>
                                <p>当前项目没有任务，请添加任务</p>
                                <button class="btn btn-primary" @click="showTaskModal()" style="margin-top: 1rem;">
                                    <i class="fas fa-plus"></i> 添加第一个任务
                                </button>
                            </div>
                            <template v-else>
                            <div v-for="status in taskStatuses" :key="status.id" class="kanban-column">
                                <div class="kanban-header">
                                    <span>{{ status.name }}</span>
                                    <div class="kanban-task-count">{{ getTasksByStatus(status.id).length }}</div>
                                </div>
                                <div class="kanban-tasks">
                                    <div
                                        v-for="task in getTasksByStatus(status.id)"
                                        :key="task.id"
                                        class="kanban-task"
                                        :data-task-id="task.id"
                                        :class="{ 'selected': selectedTasks.some(t => t.id === task.id) }"
                                        @click="selectTask(task)"
                                        @dblclick="openEditTaskModal(task)"
                                        @contextmenu.prevent="toggleTaskSelection(task)"
                                    >
                                        <div class="kanban-task-title">{{ task.name }}</div>
                                        <div class="kanban-task-meta">
                                            <span>{{ formatDate(task.startDate) }}</span>
                                            <span>{{ task.assignee }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </template>
                        </div>

                        <!-- 日历视图 -->
                        <div v-if="currentView === 'calendar'" class="calendar-container">
                            <div v-if="!currentProject" class="empty-state" style="width: 100%; height: 100%;">
                                <i class="fas fa-folder-open"></i>
                                <p>请先选择一个项目</p>
                            </div>
                            <template v-else>
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button class="btn btn-outline" @click="prevMonth" title="上一个月">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <h3>{{ currentMonth }} {{ currentYear }}</h3>
                                    <button class="btn btn-outline" @click="nextMonth" title="下一个月">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline" @click="resetToToday" title="回到今天">
                                    <i class="fas fa-calendar-day"></i> 今天
                                </button>
                            </div>
                            <!-- 日历选择器 -->
                            <div v-if="showCalendarPicker" class="card" style="position: absolute; top: 60px; right: 20px; z-index: 100; padding: 1rem;">
                                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem;">
                                    <button
                                        v-for="month in 12"
                                        :key="month"
                                        class="btn btn-outline"
                                        @click="selectMonth(month - 1)"
                                        style="padding: 0.5rem; font-size: 0.875rem;"
                                    >
                                        {{ month }}月
                                    </button>
                                </div>
                                <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                                    <button class="btn btn-outline" @click="showCalendarPicker = false" style="flex: 1;">
                                        关闭
                                    </button>
                                </div>
                            </div>
                            <div class="calendar-grid">
                                <div v-for="day in dayHeaders" :key="day" class="calendar-day-header">
                                    {{ day }}
                                </div>
                                <div
                                    v-for="(day, index) in calendarDays"
                                    :key="day.date.getTime() || index"
                                    class="calendar-day"
                                    :class="{
                                        'other-month': !day.isCurrentMonth,
                                        'today': isToday(day.date)
                                    }"
                                >
                                    <div class="calendar-day-number">{{ day.date.getDate() }}</div>
                                    <div
                                        v-for="task in getTasksForDay(day.date)"
                                        :key="task.id"
                                        class="calendar-event"
                                        :style="{ backgroundColor: getPriorityColor(task.priority) }"
                                        @click="selectTask(task)"
                                        @dblclick="openEditTaskModal(task)"
                                    >
                                        {{ task.name }}
                                    </div>
                                </div>
                            </div>
                            </template>
                        </div>

                        <!-- 资源视图 -->
                        <div v-if="currentView === 'resource'" class="resource-container">
                            <div v-if="!currentProject" class="empty-state" style="width: 100%; height: 100%;">
                                <i class="fas fa-folder-open"></i>
                                <p>请先选择一个项目</p>
                            </div>
                            <template v-else>
                            <div class="resource-chart" id="resourceChart"></div>
                            <div class="resource-list">
                                    <div v-for="member in computedTeamMembers" :key="member.id" class="resource-item">
                                        <div class="resource-avatar" :style="{
                                            background: member.load > 90 ? 'linear-gradient(135deg, #f94144, #d32f2f)' :
                                                       member.load > 70 ? 'linear-gradient(135deg, #f8961e, #f57c00)' :
                                                       'linear-gradient(135deg, var(--primary), var(--secondary))'
                                        }">
                                        {{ getInitials(member.name) }}
                                    </div>
                                    <div class="resource-info">
                                            <div class="resource-name">
                                                {{ member.name }}
                                                <span style="font-size: 0.75rem; color: var(--gray); margin-left: 0.5rem;">
                                                    ({{ member.activeTaskCount }}/{{ member.taskCount }} 任务)
                                                </span>
                                            </div>
                                        <div class="resource-skills">
                                            <span v-for="skill in member.skills" :key="skill" class="skill-tag">
                                                {{ skill }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="resource-load">
                                            <div class="load-value" :style="{
                                                color: member.load > 90 ? '#f94144' :
                                                       member.load > 70 ? '#f8961e' :
                                                       'var(--primary)'
                                            }">{{ member.load }}%</div>
                                        <div class="load-label">负载</div>
                                    </div>
                                </div>
                            </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 详情面板 -->
            <div class="detail-panel">
                <div class="card">
                    <h2><i class="fas fa-info-circle"></i> 任务详情</h2>
                    <div class="task-detail" v-if="selectedTask">
                        <div class="task-header">
                            <div class="task-title">{{ selectedTask.name }}</div>
                            <div class="task-priority" :class="'priority-' + selectedTask.priority">
                                {{ getPriorityText(selectedTask.priority) }}
                            </div>
                        </div>

                        <div class="task-meta">
                            <div class="meta-item">
                                <span class="meta-label">开始日期:</span>
                                <span class="meta-value">{{ formatDate(selectedTask.startDate) }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">结束日期:</span>
                                <span class="meta-value">{{ formatDate(selectedTask.endDate) }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">负责人:</span>
                                <span class="meta-value">{{ selectedTask.assignee }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">进度:</span>
                                <span class="meta-value">{{ selectedTask.progress }}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: selectedTask.progress + '%' }"></div>
                            </div>
                        </div>

                        <div class="task-dependencies" v-if="selectedTask.dependencies && selectedTask.dependencies.length > 0">
                            <h3>依赖任务</h3>
                            <div
                                v-for="depId in selectedTask.dependencies"
                                :key="depId"
                                class="dependency-item"
                            >
                                <div class="dependency-status" :class="'status-' + getDependencyStatus(depId)"></div>
                                <span>{{ getTaskName(depId) }}</span>
                            </div>
                        </div>

                        <div class="form-actions" style="margin-top: 1rem;">
                            <button class="btn btn-primary" @click.stop="openEditTaskModal(selectedTask)" style="flex: 1;">
                                <i class="fas fa-edit"></i> 编辑任务
                            </button>
                            <button class="btn btn-outline" @click.stop="deleteTask(selectedTask)" style="flex: 1;">
                                <i class="fas fa-trash"></i> 删除任务
                            </button>
                    </div>
                    </div>
                    <div v-else class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p>请选择一个任务查看详情</p>
                    </div>
                </div>

                <div class="card">
                    <h2>
                        <i class="fas fa-exclamation-triangle"></i> 风险预警
                        <span v-if="computedProjectRisks.length > 0" style="font-size: 0.875rem; color: var(--gray); margin-left: 0.5rem;">
                            ({{ computedProjectRisks.length }})
                        </span>
                    </h2>
                    <div class="risk-list" v-if="computedProjectRisks.length > 0">
                        <div v-for="risk in computedProjectRisks" :key="risk.id" class="risk-item" :class="risk.level">
                            <div class="risk-header">
                                <i class="fas" :class="{
                                    'fa-exclamation-circle': risk.level === 'high',
                                    'fa-exclamation-triangle': risk.level === 'medium',
                                    'fa-info-circle': risk.level === 'low'
                                }"></i>
                                <span>{{ risk.task }}</span>
                                <span style="font-size: 0.7rem; color: var(--gray); margin-left: 0.5rem;">
                                    {{ risk.type === 'overdue' ? '逾期' :
                                       risk.type === 'due-soon' ? '即将到期' :
                                       risk.type === 'progress' ? '进度落后' :
                                       risk.type === 'overload' ? '资源过载' :
                                       risk.type === 'dependency' ? '依赖延迟' :
                                       risk.type === 'high-priority' ? '高优先级' : '' }}
                                </span>
                            </div>
                            <div class="risk-description">
                                {{ risk.description }}
                            </div>
                        </div>
                    </div>
                    <div v-else class="empty-state" style="padding: 1rem;">
                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                        <p style="margin-top: 0.5rem;">暂无风险预警</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 项目模态框 -->
        <div v-if="isProjectModalVisible" class="modal-overlay" @click.self="closeProjectModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">{{ editingProject ? '编辑项目' : '新建项目' }}</h3>
                    <button class="modal-close" @click="closeProjectModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="saveProject">
                    <div class="form-group">
                        <label class="form-label">项目名称 *</label>
                        <input
                            type="text"
                            class="form-input"
                            v-model="newProject.name"
                            placeholder="请输入项目名称"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">开始日期 *</label>
                        <input
                            type="date"
                            class="form-input"
                            v-model="newProject.startDate"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">结束日期 *</label>
                        <input
                            type="date"
                            class="form-input"
                            v-model="newProject.endDate"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">项目描述</label>
                        <textarea
                            class="form-textarea"
                            v-model="newProject.description"
                            placeholder="请输入项目描述（可选）"
                        ></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" @click="closeProjectModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {{ editingProject ? '保存' : '创建' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 任务模态框 -->
        <div v-if="isTaskModalVisible" class="modal-overlay" @click.self="closeTaskModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">{{ editingTask ? '编辑任务' : '新建任务' }}</h3>
                    <button class="modal-close" @click="closeTaskModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="saveTask">
                    <div class="form-group">
                        <label class="form-label">任务名称 *</label>
                        <input
                            type="text"
                            class="form-input"
                            v-model="newTask.name"
                            placeholder="请输入任务名称"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">开始日期 *</label>
                        <input
                            type="date"
                            class="form-input"
                            v-model="newTask.startDate"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">结束日期 *</label>
                        <input
                            type="date"
                            class="form-input"
                            v-model="newTask.endDate"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">优先级</label>
                        <select class="form-select" v-model="newTask.priority">
                            <option value="low">低优先级</option>
                            <option value="medium">中优先级</option>
                            <option value="high">高优先级</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">状态</label>
                        <select class="form-select" v-model="newTask.status">
                            <option value="not-started">未开始</option>
                            <option value="in-progress">进行中</option>
                            <option value="completed">已完成</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">负责人</label>
                        <select class="form-select" v-model="newTask.assignee">
                            <option v-for="member in teamMembers" :key="member.id" :value="member.name">
                                {{ member.name }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">进度 (%)</label>
                        <input
                            type="number"
                            class="form-input"
                            v-model.number="newTask.progress"
                            min="0"
                            max="100"
                        >
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" @click="closeTaskModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {{ editingTask ? '保存' : '创建' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 设置面板 -->
        <div v-if="showSettings" class="settings-overlay active" @click="showSettings = false"></div>
        <div class="settings-panel" :class="{ active: showSettings }">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2>设置</h2>
                <button class="modal-close" @click="showSettings = false">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">主题</label>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-outline" :class="{ 'btn-primary': theme === 'light' }" @click="toggleTheme">
                        <i class="fas fa-sun"></i> 浅色
                    </button>
                    <button class="btn btn-outline" :class="{ 'btn-primary': theme === 'dark' }" @click="toggleTheme">
                        <i class="fas fa-moon"></i> 深色
                    </button>
                </div>
            </div>

            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <label class="form-label" style="margin: 0;">负责人管理</label>
                    <button class="btn btn-primary" @click="showMemberModal()" style="padding: 0.4rem 0.75rem; font-size: 0.875rem;">
                        <i class="fas fa-plus"></i> 添加负责人
                    </button>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 300px; overflow-y: auto;">
                    <div v-for="member in teamMembers" :key="member.id" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color);">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">{{ member.name }}</div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <span v-for="skill in member.skills" :key="skill" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; background: white; border-radius: 4px; border: 1px solid var(--border-color);">
                                    {{ skill }}
                                </span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-outline" @click="showMemberModal(member)" style="padding: 0.4rem 0.75rem; font-size: 0.875rem;" title="编辑">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline" @click="deleteMember(member)" style="padding: 0.4rem 0.75rem; font-size: 0.875rem; color: var(--danger);" title="删除">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div v-if="teamMembers.length === 0" style="text-align: center; padding: 2rem; color: var(--gray);">
                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                        <p>暂无负责人，请添加</p>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">数据管理</label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="btn btn-outline" @click="exportData">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                    <label class="btn btn-outline" style="cursor: pointer; text-align: center;">
                        <i class="fas fa-upload"></i> 导入数据
                        <input type="file" accept=".json" @change="importData" style="display: none;">
                    </label>
                    <button class="btn btn-outline" @click="clearAllData" style="color: var(--danger);">
                        <i class="fas fa-trash"></i> 清除所有数据
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">快捷键</label>
                <div style="font-size: 0.875rem; color: var(--gray);">
                    <div style="margin-bottom: 0.5rem;"><strong>Ctrl/Cmd + N:</strong> 新建任务</div>
                    <div style="margin-bottom: 0.5rem;"><strong>Ctrl/Cmd + Shift + N:</strong> 新建项目</div>
                    <div style="margin-bottom: 0.5rem;"><strong>Ctrl/Cmd + F:</strong> 搜索</div>
                    <div><strong>Esc:</strong> 关闭模态框</div>
                </div>
            </div>
        </div>

        <!-- 负责人管理模态框 -->
        <div v-if="isMemberModalVisible" class="modal-overlay" @click.self="closeMemberModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">{{ editingMember ? '编辑负责人' : '添加负责人' }}</h3>
                    <button class="modal-close" @click="closeMemberModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="saveMember">
                    <div class="form-group">
                        <label class="form-label">姓名 *</label>
                        <input
                            type="text"
                            class="form-input"
                            v-model="newMember.name"
                            placeholder="请输入负责人姓名"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">技能标签</label>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input
                                type="text"
                                class="form-input"
                                v-model="newSkill"
                                placeholder="输入技能后按回车添加"
                                @keydown.enter.prevent="addSkill"
                                style="flex: 1;"
                            >
                            <button type="button" class="btn btn-outline" @click="addSkill">
                                <i class="fas fa-plus"></i> 添加
                            </button>
                        </div>
                        <div v-if="newMember.skills.length > 0" style="display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; min-height: 40px;">
                            <span
                                v-for="(skill, index) in newMember.skills"
                                :key="index"
                                style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: white; border-radius: 6px; border: 1px solid var(--border-color); font-size: 0.875rem;"
                            >
                                {{ skill }}
                                <button
                                    type="button"
                                    @click="removeSkill(index)"
                                    style="background: none; border: none; color: var(--danger); cursor: pointer; padding: 0; font-size: 0.875rem;"
                                    title="删除"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </span>
                        </div>
                        <div v-else style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; text-align: center; color: var(--gray); font-size: 0.875rem;">
                            暂无技能标签
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" @click="closeMemberModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {{ editingMember ? '保存' : '创建' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 检查Vue是否加载 - 等待一段时间让备用CDN加载
        function checkVueLoaded(retries = 0) {
            if (typeof Vue === 'undefined') {
                if (retries < 30) {  // 增加重试次数到30次（15秒），给CDN更多时间
                    if (retries % 3 === 0) {  // 每3次重试才打印一次日志
                        console.log(`等待Vue加载... (${Math.floor(retries/3) + 1}/10)`);
                    }
                    setTimeout(() => checkVueLoaded(retries + 1), 500);
                } else {
                    console.error('Vue未加载！所有CDN都失败，已重试30次');
                    if (typeof showVueError === 'function') {
                        showVueError();
                    } else {
                        // 如果showVueError未定义，直接显示错误
                        if (document.body) {
                            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>Vue.js加载失败</h1><p>请刷新页面重试</p><button onclick="location.reload()">刷新</button></div>';
                        }
                    }
                }
                return;
            }
            console.log('✓ Vue.js已成功加载，版本:', Vue.version || '未知');
            // 再等待一小段时间确保Vue完全初始化
            setTimeout(() => {
                try {
                    initializeApp();
                } catch (error) {
                    console.error('初始化应用失败:', error);
                }
            }, 200);
        }

        // 延迟初始化应用
        function initializeApp() {

        const { createApp } = Vue;

        // 示例数据
        const sampleProjects = [
            {
                id: 1,
                name: "网站重构项目",
                startDate: new Date(2023, 5, 1),
                endDate: new Date(2023, 7, 15),
                tasks: [
                    { id: 1, name: "需求分析", startDate: new Date(2023, 5, 1), endDate: new Date(2023, 5, 7), progress: 100, priority: "low", status: "completed", assignee: "张三", dependencies: [] },
                    { id: 2, name: "UI/UX设计", startDate: new Date(2023, 5, 8), endDate: new Date(2023, 5, 21), progress: 80, priority: "medium", status: "in-progress", assignee: "李四", dependencies: [1] },
                    { id: 3, name: "前端开发", startDate: new Date(2023, 5, 15), endDate: new Date(2023, 6, 10), progress: 30, priority: "high", status: "in-progress", assignee: "王五", dependencies: [2] },
                    { id: 4, name: "后端开发", startDate: new Date(2023, 5, 22), endDate: new Date(2023, 6, 15), progress: 20, priority: "high", status: "not-started", assignee: "赵六", dependencies: [1] },
                    { id: 5, name: "测试与调试", startDate: new Date(2023, 6, 16), endDate: new Date(2023, 7, 5), progress: 0, priority: "medium", status: "not-started", assignee: "钱七", dependencies: [3, 4] },
                    { id: 6, name: "部署上线", startDate: new Date(2023, 7, 6), endDate: new Date(2023, 7, 15), progress: 0, priority: "high", status: "not-started", assignee: "孙八", dependencies: [5] }
                ]
            },
            {
                id: 2,
                name: "移动应用开发",
                startDate: new Date(2023, 4, 1),
                endDate: new Date(2023, 8, 30),
                tasks: [
                    { id: 7, name: "市场调研", startDate: new Date(2023, 4, 1), endDate: new Date(2023, 4, 15), progress: 100, priority: "low", status: "completed", assignee: "张三", dependencies: [] },
                    { id: 8, name: "原型设计", startDate: new Date(2023, 4, 16), endDate: new Date(2023, 5, 5), progress: 100, priority: "medium", status: "completed", assignee: "李四", dependencies: [7] },
                    { id: 9, name: "iOS开发", startDate: new Date(2023, 5, 6), endDate: new Date(2023, 7, 10), progress: 60, priority: "high", status: "in-progress", assignee: "王五", dependencies: [8] },
                    { id: 10, name: "Android开发", startDate: new Date(2023, 5, 6), endDate: new Date(2023, 7, 10), progress: 40, priority: "high", status: "in-progress", assignee: "赵六", dependencies: [8] },
                    { id: 11, name: "后端API开发", startDate: new Date(2023, 5, 1), endDate: new Date(2023, 6, 15), progress: 90, priority: "high", status: "in-progress", assignee: "钱七", dependencies: [] },
                    { id: 12, name: "测试与发布", startDate: new Date(2023, 7, 11), endDate: new Date(2023, 8, 30), progress: 0, priority: "medium", status: "not-started", assignee: "孙八", dependencies: [9, 10, 11] }
                ]
            }
        ];

        const teamMembers = [
            { id: 1, name: "张三", skills: ["UI设计", "用户体验"], load: 70 },
            { id: 2, name: "李四", skills: ["前端开发", "Vue.js"], load: 85 },
            { id: 3, name: "王五", skills: ["iOS开发", "Swift"], load: 60 },
            { id: 4, name: "赵六", skills: ["Android开发", "Kotlin"], load: 75 },
            { id: 5, name: "钱七", skills: ["后端开发", "Node.js"], load: 80 },
            { id: 6, name: "孙八", skills: ["测试", "质量保证"], load: 40 }
        ];

        const taskStatuses = [
            { id: "not-started", name: "未开始" },
            { id: "in-progress", name: "进行中" },
            { id: "completed", name: "已完成" }
        ];

        const views = [
            { id: "gantt", name: "甘特图", icon: "fas fa-chart-bar" },
            { id: "kanban", name: "看板", icon: "fas fa-columns" },
            { id: "calendar", name: "日历", icon: "fas fa-calendar-alt" },
            { id: "resource", name: "资源", icon: "fas fa-users" }
        ];

        const VueApp = createApp({
            data() {
                return {
                    projects: sampleProjects,
                    currentProject: sampleProjects[0],
                    currentView: "gantt",
                    views: views,
                    teamMembers: teamMembers,
                    taskStatuses: taskStatuses,
                    selectedTask: null,
                    isTaskModalVisible: false,
                    editingTask: null,
                    currentMonth: new Date().toLocaleString('zh-CN', { month: 'long' }),
                    currentYear: new Date().getFullYear(),
                    calendarDate: new Date(),
                    dayHeaders: ['日', '一', '二', '三', '四', '五', '六'],
                    projectRisks: [],
                    newTask: {
                        name: "",
                        startDate: "",
                        endDate: "",
                        priority: "medium",
                        status: "not-started",
                        assignee: "",
                        progress: 0,
                        dependencies: []
                    },
                    resourceChart: null,
                    nextTaskId: 13,
                    nextProjectId: 3,
                    toast: null,
                    toastTimer: null,
                    isProjectModalVisible: false,
                    editingProject: null,
                    newProject: {
                        name: "",
                        startDate: "",
                        endDate: "",
                        description: ""
                    },
                    searchQuery: "",
                    filterStatus: "all",
                    filterPriority: "all",
                    filterAssignee: "all",
                    showSettings: false,
                    theme: "light",
                    selectedTasks: [],
                    showBulkActions: false,
                    isFullscreen: false,
                    showCalendarPicker: false,
                    fullscreenElement: null,
                    isMemberModalVisible: false,
                    editingMember: null,
                    newMember: {
                        name: "",
                        skills: []
                    },
                    newSkill: "",
                    nextMemberId: 7
                };
            },
            computed: {
                currentViewName() {
                    const view = this.views.find(v => v.id === this.currentView);
                    return view ? view.name : "";
                },
                completedTasks() {
                    return this.currentProject.tasks.filter(task => task.status === "completed").length;
                },
                totalTasks() {
                    return this.currentProject.tasks.length;
                },
                overdueTasks() {
                    const today = new Date();
                    return this.currentProject.tasks.filter(task =>
                        task.endDate < today && task.status !== "completed"
                    ).length;
                },
                projectDuration() {
                    const diffTime = Math.abs(this.currentProject.endDate - this.currentProject.startDate);
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                },
                projectHealth() {
                    // 简单的健康度计算：基于完成进度和逾期任务
                    const progressScore = (this.completedTasks / this.totalTasks) * 70;
                    const overduePenalty = this.overdueTasks * 10;
                    return Math.max(0, Math.min(100, progressScore - overduePenalty));
                },
                projectHealthClass() {
                    if (this.projectHealth >= 70) return "good";
                    if (this.projectHealth >= 40) return "";
                    return "warning";
                },
                timelineDays() {
                    const days = [];
                    const start = new Date(this.currentProject.startDate);
                    const end = new Date(this.currentProject.endDate);
                    const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24));

                    // 如果项目周期超过90天，按周显示；否则按天显示
                    if (duration > 90) {
                        // 按周显示
                        const currentDate = new Date(start);
                        while (currentDate <= end) {
                            days.push(new Date(currentDate));
                            currentDate.setDate(currentDate.getDate() + 7);
                        }
                        // 确保最后一天包含在内
                        if (days[days.length - 1] < end) {
                            days.push(new Date(end));
                        }
                    } else {
                        // 按天显示（如果天数太多，可以按每隔几天显示）
                        const step = duration > 30 ? 3 : 1;
                        for (let date = new Date(start); date <= end; date.setDate(date.getDate() + step)) {
                        days.push(new Date(date));
                        }
                        // 确保最后一天包含在内
                        if (days[days.length - 1] < end) {
                            days.push(new Date(end));
                        }
                    }

                    return days;
                },
                calendarDays() {
                    const year = this.calendarDate.getFullYear();
                    const month = this.calendarDate.getMonth();

                    // 当月第一天
                    const firstDay = new Date(year, month, 1);
                    // 当月最后一天
                    const lastDay = new Date(year, month + 1, 0);
                    // 当月第一天是周几（0-6，0是周日）
                    const firstDayOfWeek = firstDay.getDay();
                    // 当月总天数
                    const daysInMonth = lastDay.getDate();

                    // 上个月最后几天
                    const prevMonthLastDay = new Date(year, month, 0).getDate();

                    const days = [];

                    // 添加上个月的最后几天
                    for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                        const date = new Date(year, month - 1, prevMonthLastDay - i);
                        days.push({ date, isCurrentMonth: false });
                    }

                    // 添加当月的所有天
                    for (let i = 1; i <= daysInMonth; i++) {
                        const date = new Date(year, month, i);
                        days.push({ date, isCurrentMonth: true });
                    }

                    // 添加下个月的前几天，补齐6行
                    const totalCells = 42; // 6行 * 7天
                    const nextMonthDays = totalCells - days.length;
                    for (let i = 1; i <= nextMonthDays; i++) {
                        const date = new Date(year, month + 1, i);
                        days.push({ date, isCurrentMonth: false });
                    }

                    return days;
                },
                filteredTasks() {
                    let tasks = this.currentProject?.tasks || [];

                    // 搜索
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        tasks = tasks.filter(task =>
                            task.name.toLowerCase().includes(query) ||
                            task.assignee?.toLowerCase().includes(query)
                        );
                    }

                    // 状态筛选
                    if (this.filterStatus !== 'all') {
                        tasks = tasks.filter(task => task.status === this.filterStatus);
                    }

                    // 优先级筛选
                    if (this.filterPriority !== 'all') {
                        tasks = tasks.filter(task => task.priority === this.filterPriority);
                    }

                    // 负责人筛选
                    if (this.filterAssignee !== 'all') {
                        tasks = tasks.filter(task => task.assignee === this.filterAssignee);
                    }

                    return tasks;
                },
                // 计算每个成员的实际工作负载
                computedTeamMembers() {
                    if (!this.currentProject) return this.teamMembers;

                    return this.teamMembers.map(member => {
                        // 获取分配给该成员的所有任务
                        const memberTasks = this.currentProject.tasks.filter(
                            task => task.assignee === member.name
                        );

                        // 计算总工作量（基于任务数量、优先级和进度）
                        let totalLoad = 0;
                        memberTasks.forEach(task => {
                            // 基础工作量：每个任务10分
                            let taskLoad = 10;

                            // 根据优先级加权
                            if (task.priority === 'high') taskLoad *= 1.5;
                            else if (task.priority === 'medium') taskLoad *= 1.2;

                            // 根据任务时长加权（天数）
                            const taskDuration = Math.ceil(
                                (new Date(task.endDate) - new Date(task.startDate)) / (1000 * 60 * 60 * 24)
                            );
                            taskLoad *= Math.min(taskDuration / 7, 2); // 最多2倍

                            // 未完成的任务计入负载
                            if (task.status !== 'completed') {
                                totalLoad += taskLoad;
                            } else {
                                // 已完成的任务只计入少量负载（维护工作）
                                totalLoad += taskLoad * 0.1;
                            }
                        });

                        // 转换为百分比（假设每人最大工作量为100分）
                        const maxLoad = 100;
                        const loadPercentage = Math.min(Math.round((totalLoad / maxLoad) * 100), 100);

                        return {
                            ...member,
                            load: loadPercentage,
                            taskCount: memberTasks.length,
                            activeTaskCount: memberTasks.filter(t => t.status !== 'completed').length
                        };
                    });
                },
                // 计算项目风险预警
                computedProjectRisks() {
                    if (!this.currentProject || !this.currentProject.tasks.length) {
                        return [];
                    }

                    const risks = [];
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    // 1. 检查逾期任务
                    this.currentProject.tasks.forEach(task => {
                        const endDate = new Date(task.endDate);
                        endDate.setHours(0, 0, 0, 0);
                        const daysOverdue = Math.ceil((today - endDate) / (1000 * 60 * 60 * 24));

                        if (daysOverdue > 0 && task.status !== 'completed') {
                            risks.push({
                                id: `overdue-${task.id}`,
                                task: task.name,
                                description: `任务已逾期 ${daysOverdue} 天`,
                                level: daysOverdue > 7 ? 'high' : daysOverdue > 3 ? 'medium' : 'low',
                                type: 'overdue'
                            });
                        }
                    });

                    // 2. 检查即将到期的任务（3天内）
                    this.currentProject.tasks.forEach(task => {
                        const endDate = new Date(task.endDate);
                        endDate.setHours(0, 0, 0, 0);
                        const daysUntilDue = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));

                        if (daysUntilDue >= 0 && daysUntilDue <= 3 && task.status !== 'completed') {
                            const progress = task.progress || 0;
                            // 如果进度不足，风险更高
                            const expectedProgress = daysUntilDue === 0 ? 100 :
                                                   daysUntilDue === 1 ? 90 :
                                                   daysUntilDue === 2 ? 80 : 70;

                            if (progress < expectedProgress) {
                                risks.push({
                                    id: `due-soon-${task.id}`,
                                    task: task.name,
                                    description: `任务将在 ${daysUntilDue} 天后到期，但进度仅为 ${progress}%`,
                                    level: progress < expectedProgress * 0.5 ? 'high' : 'medium',
                                    type: 'due-soon'
                                });
                            }
                        }
                    });

                    // 3. 检查进度落后的任务
                    this.currentProject.tasks.forEach(task => {
                        if (task.status === 'completed') return;

                        const startDate = new Date(task.startDate);
                        const endDate = new Date(task.endDate);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);

                        const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                        const elapsedDays = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));

                        if (elapsedDays > 0 && totalDays > 0) {
                            const expectedProgress = Math.min((elapsedDays / totalDays) * 100, 100);
                            const actualProgress = task.progress || 0;
                            const progressGap = expectedProgress - actualProgress;

                            if (progressGap > 20) {
                                risks.push({
                                    id: `progress-${task.id}`,
                                    task: task.name,
                                    description: `进度落后 ${Math.round(progressGap)}%，预期 ${Math.round(expectedProgress)}%，实际 ${actualProgress}%`,
                                    level: progressGap > 40 ? 'high' : 'medium',
                                    type: 'progress'
                                });
                            }
                        }
                    });

                    // 4. 检查资源过载
                    this.computedTeamMembers.forEach(member => {
                        if (member.load > 90) {
                            risks.push({
                                id: `overload-${member.id}`,
                                task: member.name,
                                description: `资源负载过高 (${member.load}%)，有 ${member.activeTaskCount} 个进行中的任务`,
                                level: member.load > 100 ? 'high' : 'medium',
                                type: 'overload'
                            });
                        }
                    });

                    // 5. 检查依赖任务延迟
                    this.currentProject.tasks.forEach(task => {
                        if (!task.dependencies || task.dependencies.length === 0) return;
                        if (task.status === 'completed') return;

                        task.dependencies.forEach(depId => {
                            const depTask = this.currentProject.tasks.find(t => t.id === depId);
                            if (!depTask) return;

                            // 如果依赖任务未完成但已超过其结束日期
                            const depEndDate = new Date(depTask.endDate);
                            depEndDate.setHours(0, 0, 0, 0);

                            if (depTask.status !== 'completed' && today > depEndDate) {
                                const daysDelayed = Math.ceil((today - depEndDate) / (1000 * 60 * 60 * 24));
                                risks.push({
                                    id: `dependency-${task.id}-${depId}`,
                                    task: task.name,
                                    description: `依赖任务"${depTask.name}"已延迟 ${daysDelayed} 天，可能影响当前任务`,
                                    level: daysDelayed > 7 ? 'high' : daysDelayed > 3 ? 'medium' : 'low',
                                    type: 'dependency'
                                });
                            }
                        });
                    });

                    // 6. 检查高优先级未开始任务
                    this.currentProject.tasks.forEach(task => {
                        if (task.priority === 'high' && task.status === 'not-started') {
                            const startDate = new Date(task.startDate);
                            startDate.setHours(0, 0, 0, 0);

                            if (today >= startDate) {
                                risks.push({
                                    id: `high-priority-${task.id}`,
                                    task: task.name,
                                    description: '高优先级任务应已开始但尚未开始',
                                    level: 'high',
                                    type: 'high-priority'
                                });
                            }
                        }
                    });

                    // 按风险等级排序：high > medium > low
                    const levelOrder = { high: 3, medium: 2, low: 1 };
                    risks.sort((a, b) => levelOrder[b.level] - levelOrder[a.level]);

                    return risks;
                }
            },
            mounted() {
                // 加载保存的数据
                this.loadData();

                this.selectedTask = this.currentProject?.tasks[0] || null;
                this.initResourceChart();
                this.initKanbanDrag();

                // 初始化ID
                this.initializeIds();

                // 加载主题
                this.loadTheme();

                // 绑定快捷键
                this.bindKeyboardShortcuts();

                // 监听数据变化，自动保存
                this.autoSave();

                // 监听任务和项目变化，自动更新资源图表和风险预警
                this.$watch('currentProject', () => {
                    this.$nextTick(() => {
                        if (this.currentView === 'resource') {
                            this.initResourceChart();
                        }
                    });
                }, { deep: true });

                this.$watch(() => this.currentProject?.tasks, () => {
                    this.$nextTick(() => {
                        if (this.currentView === 'resource') {
                            this.initResourceChart();
                        }
                    });
                }, { deep: true });

                // 监听全屏状态变化
                document.addEventListener('fullscreenchange', () => {
                    this.isFullscreen = !!document.fullscreenElement;
                });
                document.addEventListener('webkitfullscreenchange', () => {
                    this.isFullscreen = !!document.webkitFullscreenElement;
                });
                document.addEventListener('mozfullscreenchange', () => {
                    this.isFullscreen = !!document.mozFullScreenElement;
                });
                document.addEventListener('MSFullscreenChange', () => {
                    this.isFullscreen = !!document.msFullscreenElement;
                });
            },
            beforeUnmount() {
                // 清理图表实例
                if (this.resourceChart) {
                    this.resourceChart.destroy();
                }
                if (this.toastTimer) {
                    clearTimeout(this.toastTimer);
                }
            },
            methods: {
                switchView(view) {
                    this.currentView = view;
                    // 切换视图时重新初始化拖拽功能
                    if (view === 'kanban') {
                        this.$nextTick(() => {
                            this.initKanbanDrag();
                        });
                    }
                    // 切换视图时重新初始化资源图表
                    if (view === 'resource') {
                        this.$nextTick(() => {
                            this.initResourceChart();
                        });
                    }
                },
                selectProject(project) {
                    this.currentProject = project;
                    this.selectedTask = project.tasks[0] || null;

                    // 重新初始化相关视图
                    if (this.currentView === 'resource') {
                        this.$nextTick(() => {
                            this.initResourceChart();
                        });
                    }
                    if (this.currentView === 'kanban') {
                        this.$nextTick(() => {
                            this.initKanbanDrag();
                        });
                    }
                },
                selectTask(task) {
                    this.selectedTask = task;
                },
                getTasksByStatus(status) {
                    // 在看板视图中，即使有筛选也显示所有任务，但可以标记筛选状态
                    let tasks = this.currentProject?.tasks || [];

                    // 先按状态筛选
                    tasks = tasks.filter(task => task.status === status);

                    // 如果应用了其他筛选，也应用
                    if (this.searchQuery || this.filterPriority !== 'all' || this.filterAssignee !== 'all') {
                        // 应用搜索和筛选
                        if (this.searchQuery) {
                            const query = this.searchQuery.toLowerCase();
                            tasks = tasks.filter(task =>
                                task.name.toLowerCase().includes(query) ||
                                task.assignee?.toLowerCase().includes(query)
                            );
                        }
                        if (this.filterPriority !== 'all') {
                            tasks = tasks.filter(task => task.priority === this.filterPriority);
                        }
                        if (this.filterAssignee !== 'all') {
                            tasks = tasks.filter(task => task.assignee === this.filterAssignee);
                        }
                    }

                    return tasks;
                },
                getPriorityColor(priority) {
                    switch(priority) {
                        case "high": return "#f94144";
                        case "medium": return "#f8961e";
                        case "low": return "#43aa8b";
                        default: return "#6c757d";
                    }
                },
                getPriorityText(priority) {
                    switch(priority) {
                        case "high": return "高优先级";
                        case "medium": return "中优先级";
                        case "low": return "低优先级";
                        default: return "普通";
                    }
                },
                formatDate(date) {
                    return date.toLocaleDateString('zh-CN');
                },
                formatTimelineDate(date) {
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    return `${month}/${day}`;
                },
                calculateTaskPosition(startDate) {
                    const projectStart = new Date(this.currentProject.startDate);
                    const taskStart = new Date(startDate);
                    const projectDuration = this.projectDuration;
                    const daysFromStart = Math.ceil((taskStart - projectStart) / (1000 * 60 * 60 * 24));

                    return (daysFromStart / projectDuration) * 100;
                },
                calculateTaskWidth(startDate, endDate) {
                    const taskStart = new Date(startDate);
                    const taskEnd = new Date(endDate);
                    const taskDuration = Math.ceil((taskEnd - taskStart) / (1000 * 60 * 60 * 24));
                    const projectDuration = this.projectDuration;

                    return (taskDuration / projectDuration) * 100;
                },
                getTasksForDay(date) {
                    return this.currentProject.tasks.filter(task => {
                        const taskStart = new Date(task.startDate);
                        const taskEnd = new Date(task.endDate);
                        return date >= taskStart && date <= taskEnd;
                    });
                },
                prevMonth() {
                    this.calendarDate = new Date(this.calendarDate.getFullYear(), this.calendarDate.getMonth() - 1, 1);
                    this.currentMonth = this.calendarDate.toLocaleString('zh-CN', { month: 'long' });
                    this.currentYear = this.calendarDate.getFullYear();
                    this.showCalendarPicker = false;
                },
                nextMonth() {
                    this.calendarDate = new Date(this.calendarDate.getFullYear(), this.calendarDate.getMonth() + 1, 1);
                    this.currentMonth = this.calendarDate.toLocaleString('zh-CN', { month: 'long' });
                    this.currentYear = this.calendarDate.getFullYear();
                    this.showCalendarPicker = false;
                },
                resetToToday() {
                    this.calendarDate = new Date();
                    this.currentMonth = this.calendarDate.toLocaleString('zh-CN', { month: 'long' });
                    this.currentYear = this.calendarDate.getFullYear();
                    this.showCalendarPicker = false;
                    this.showToast('已回到今天', 'success');
                },
                selectMonth(month) {
                    this.calendarDate = new Date(this.calendarDate.getFullYear(), month, 1);
                    this.currentMonth = this.calendarDate.toLocaleString('zh-CN', { month: 'long' });
                    this.currentYear = this.calendarDate.getFullYear();
                    this.showCalendarPicker = false;
                    this.showToast(`已切换到${this.currentMonth}`, 'success');
                },
                isToday(date) {
                    const today = new Date();
                    return date.getDate() === today.getDate() &&
                           date.getMonth() === today.getMonth() &&
                           date.getFullYear() === today.getFullYear();
                },
                getInitials(name) {
                    return name.split('').slice(0, 2).join('');
                },
                getDependencyStatus(depId) {
                    const task = this.currentProject.tasks.find(t => t.id === depId);
                    return task ? task.status : "not-started";
                },
                getTaskName(taskId) {
                    const task = this.currentProject.tasks.find(t => t.id === taskId);
                    return task ? task.name : "未知任务";
                },
                initResourceChart() {
                    // 销毁旧图表实例
                    if (this.resourceChart) {
                        this.resourceChart.destroy();
                        this.resourceChart = null;
                    }

                    const chartElement = document.querySelector("#resourceChart");
                    if (!chartElement) {
                        return;
                    }

                    // 使用计算后的团队成员数据
                    const members = this.computedTeamMembers;

                    // 根据负载设置颜色：高负载(>90%)红色，中负载(70-90%)橙色，低负载绿色
                    const colors = members.map(member => {
                        if (member.load > 90) return '#f94144'; // 红色
                        if (member.load > 70) return '#f8961e'; // 橙色
                        return '#43aa8b'; // 绿色
                    });

                    const options = {
                        series: [{
                            name: '工作负载',
                            data: members.map(member => member.load)
                        }],
                        chart: {
                            height: 300,
                            type: 'bar',
                            toolbar: {
                                show: false
                            }
                        },
                        colors: colors,
                        plotOptions: {
                            bar: {
                                borderRadius: 4,
                                horizontal: true,
                                distributed: true,
                                dataLabels: {
                                    position: 'top',
                                    formatter: function(val) {
                                        return val + '%';
                                    }
                                }
                            }
                        },
                        dataLabels: {
                            enabled: true,
                            style: {
                                fontSize: '12px',
                                fontWeight: 600
                            }
                        },
                        xaxis: {
                            categories: members.map(member => member.name),
                            max: 100,
                            title: {
                                text: '工作负载 (%)'
                            }
                        },
                        yaxis: {
                            labels: {
                                style: {
                                    fontSize: '12px'
                                }
                            }
                        },
                        tooltip: {
                            y: {
                                formatter: function(val, { dataPointIndex }) {
                                    const member = members[dataPointIndex];
                                    return `${member.name}: ${val}% (${member.activeTaskCount}/${member.taskCount} 任务)`;
                                }
                            }
                        }
                    };

                    this.resourceChart = new ApexCharts(chartElement, options);
                    this.resourceChart.render();
                },
                initKanbanDrag() {
                    this.$nextTick(() => {
                        // 先销毁旧的Sortable实例（如果存在）
                        const kanbanColumns = document.querySelectorAll('.kanban-tasks');
                        kanbanColumns.forEach((column) => {
                            if (column.sortableInstance) {
                                column.sortableInstance.destroy();
                            }
                        });

                        // 创建新的Sortable实例
                        kanbanColumns.forEach((column, colIndex) => {
                            const statusId = this.taskStatuses[colIndex].id;
                            const sortable = new Sortable(column, {
                                group: 'kanban',
                                animation: 150,
                                onEnd: (evt) => {
                                    const taskId = parseInt(evt.item.dataset.taskId);
                                    const task = this.currentProject.tasks.find(t => t.id === taskId);
                                    if (task && task.status !== statusId) {
                                        task.status = statusId;
                                        this.showToast('任务状态已更新', 'success');
                                        this.saveData();
                                        // 更新资源图表
                                        this.$nextTick(() => {
                                            if (this.currentView === 'resource') {
                                                this.initResourceChart();
                                            }
                                        });
                                    }
                                }
                            });
                            // 保存实例引用以便后续销毁
                            column.sortableInstance = sortable;
                        });
                    });
                },
                openEditTaskModal(task) {
                    if (!task) {
                        this.showToast('请先选择一个任务', 'error');
                        return;
                    }
                    // 编辑模式
                    this.editingTask = task;
                    this.newTask = {
                        name: task.name,
                        startDate: this.formatDateForInput(task.startDate),
                        endDate: this.formatDateForInput(task.endDate),
                        priority: task.priority,
                        status: task.status,
                        assignee: task.assignee,
                        progress: task.progress,
                        dependencies: [...(task.dependencies || [])]
                    };
                    this.isTaskModalVisible = true;
                },
                showTaskModal(task = null) {
                    console.log('=== showTaskModal被调用 ===', task);
                    console.log('当前isTaskModalVisible值:', this.isTaskModalVisible);
                    console.log('this对象:', this);

                    // 确保方法被正确调用
                    console.log('showTaskModal方法被调用！');

                    try {
                        // 检查是否有当前项目
                        if (!task && !this.currentProject) {
                            this.showToast('请先选择一个项目', 'error');
                            return;
                        }

                        if (task) {
                            // 编辑模式
                            console.log('编辑任务模式', task);
                            this.editingTask = task;
                            this.newTask = {
                                name: task.name,
                                startDate: this.formatDateForInput(task.startDate),
                                endDate: this.formatDateForInput(task.endDate),
                                priority: task.priority,
                                status: task.status,
                                assignee: task.assignee,
                                progress: task.progress,
                                dependencies: [...(task.dependencies || [])]
                            };
                        } else {
                            // 新建模式
                            console.log('新建任务模式');
                            this.editingTask = null;
                            const today = new Date();
                            const nextWeek = new Date(today);
                            nextWeek.setDate(today.getDate() + 7);
                            this.newTask = {
                                name: "",
                                startDate: this.formatDateForInput(today),
                                endDate: this.formatDateForInput(nextWeek),
                                priority: "medium",
                                status: "not-started",
                                assignee: this.teamMembers[0]?.name || "",
                                progress: 0,
                                dependencies: []
                            };
                        }

                        // 设置模态框显示状态
                        this.isTaskModalVisible = true;

                        console.log('isTaskModalVisible设置为true', this.isTaskModalVisible);
                        console.log('验证值:', this.isTaskModalVisible);

                        // 验证模态框是否应该显示
                        setTimeout(() => {
                            const modal = document.querySelector('.modal-overlay');
                            console.log('模态框元素:', modal);
                            if (!modal) {
                                console.error('模态框元素未找到！');
                            }
                        }, 100);

                    } catch (error) {
                        console.error('打开任务模态框失败:', error);
                        console.error('错误堆栈:', error.stack);
                        this.showToast('打开任务模态框失败: ' + error.message, 'error');
                    }
                },
                closeTaskModal() {
                    this.isTaskModalVisible = false;
                    this.editingTask = null;
                    this.newTask = {
                        name: "",
                        startDate: "",
                        endDate: "",
                        priority: "medium",
                        status: "not-started",
                        assignee: "",
                        progress: 0,
                        dependencies: []
                    };
                },
                saveTask() {
                    // 验证必填字段
                    if (!this.newTask.name.trim()) {
                        this.showToast('请输入任务名称', 'error');
                        return;
                    }
                    if (!this.newTask.startDate || !this.newTask.endDate) {
                        this.showToast('请选择开始和结束日期', 'error');
                        return;
                    }

                    const startDate = new Date(this.newTask.startDate);
                    const endDate = new Date(this.newTask.endDate);

                    if (endDate < startDate) {
                        this.showToast('结束日期不能早于开始日期', 'error');
                        return;
                    }

                    if (this.editingTask) {
                        // 更新现有任务
                        Object.assign(this.editingTask, {
                            name: this.newTask.name,
                            startDate: startDate,
                            endDate: endDate,
                            priority: this.newTask.priority,
                            status: this.newTask.status,
                            assignee: this.newTask.assignee,
                            progress: parseInt(this.newTask.progress) || 0,
                            dependencies: this.newTask.dependencies || []
                        });
                        this.showToast('任务已更新', 'success');
                        this.saveData();
                        // 更新资源图表
                        this.$nextTick(() => {
                            if (this.currentView === 'resource') {
                                this.initResourceChart();
                            }
                        });
                    } else {
                        // 创建新任务
                        const newTask = {
                            id: this.nextTaskId++,
                            name: this.newTask.name,
                            startDate: startDate,
                            endDate: endDate,
                            progress: parseInt(this.newTask.progress) || 0,
                            priority: this.newTask.priority,
                            status: this.newTask.status,
                            assignee: this.newTask.assignee,
                            dependencies: this.newTask.dependencies || []
                        };
                        this.currentProject.tasks.push(newTask);
                        this.showToast('任务已创建', 'success');
                        this.saveData();
                    }
                    this.closeTaskModal();
                    // 更新资源图表
                    this.$nextTick(() => {
                        if (this.currentView === 'resource') {
                            this.initResourceChart();
                        }
                    });
                },
                deleteTask(task) {
                    if (confirm(`确定要删除任务"${task.name}"吗？`)) {
                        const index = this.currentProject.tasks.findIndex(t => t.id === task.id);
                        if (index > -1) {
                            this.currentProject.tasks.splice(index, 1);
                            if (this.selectedTask && this.selectedTask.id === task.id) {
                                this.selectedTask = this.currentProject.tasks[0] || null;
                            }
                            this.showToast('任务已删除', 'success');
                            this.saveData();
                            // 更新资源图表
                            this.$nextTick(() => {
                                if (this.currentView === 'resource') {
                                    this.initResourceChart();
                                }
                            });
                        }
                    }
                },
                formatDateForInput(date) {
                    if (!date) return "";
                    const d = new Date(date);
                    const year = d.getFullYear();
                    const month = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                },
                exportData() {
                    try {
                        const data = {
                            projects: this.projects.map(p => ({
                                ...p,
                                tasks: p.tasks.map(t => ({
                                    ...t,
                                    startDate: t.startDate.toISOString(),
                                    endDate: t.endDate.toISOString()
                                })),
                                startDate: p.startDate.toISOString(),
                                endDate: p.endDate.toISOString()
                            }))
                        };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `project-timeline-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        this.showToast('数据导出成功', 'success');
                    } catch (error) {
                        this.showToast('导出失败: ' + error.message, 'error');
                    }
                },
                shareProject() {
                    try {
                        if (!this.currentProject) {
                            this.showToast('请先选择一个项目', 'error');
                            return;
                        }

                        const shareData = {
                            projectName: this.currentProject.name,
                            projectHealth: this.projectHealth,
                            totalTasks: this.totalTasks,
                            completedTasks: this.completedTasks,
                            url: window.location.href
                        };
                        const shareText = `项目: ${shareData.projectName}\n健康度: ${shareData.projectHealth}%\n任务: ${shareData.completedTasks}/${shareData.totalTasks}\n链接: ${shareData.url}`;

                        if (navigator.share) {
                            navigator.share({
                                title: shareData.projectName + ' - 项目时间线',
                                text: shareText
                            }).catch(() => {
                                this.copyToClipboard(shareText);
                            });
                        } else {
                            this.copyToClipboard(shareText);
                        }
                    } catch (error) {
                        this.showToast('分享失败: ' + error.message, 'error');
                    }
                },
                copyToClipboard(text) {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(text).then(() => {
                            this.showToast('已复制到剪贴板', 'success');
                        }).catch(() => {
                            this.showToast('复制失败', 'error');
                        });
                    } else {
                        // 降级方案
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        document.body.appendChild(textarea);
                        textarea.select();
                        try {
                            document.execCommand('copy');
                            this.showToast('已复制到剪贴板', 'success');
                        } catch (err) {
                            this.showToast('复制失败', 'error');
                        }
                        document.body.removeChild(textarea);
                    }
                },
                showToast(message, type = 'info') {
                    // 清除旧的提示
                    if (this.toast) {
                        this.toast.remove();
                    }
                    if (this.toastTimer) {
                        clearTimeout(this.toastTimer);
                    }

                    // 创建新提示
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
                    toast.innerHTML = `
                        <i class="fas ${icon}"></i>
                        <span>${message}</span>
                    `;
                    document.body.appendChild(toast);
                    this.toast = toast;

                    // 自动移除
                    this.toastTimer = setTimeout(() => {
                        toast.style.animation = 'slideInRight 0.3s reverse';
                        setTimeout(() => {
                            toast.remove();
                        this.toast = null;
                    }, 300);
                }, 3000);
                },
                // ========== 数据持久化 ==========
                saveData() {
                    try {
                        const dataToSave = {
                            projects: this.projects.map(p => ({
                                ...p,
                                tasks: p.tasks.map(t => ({
                                    ...t,
                                    startDate: t.startDate.toISOString(),
                                    endDate: t.endDate.toISOString()
                                })),
                                startDate: p.startDate.toISOString(),
                                endDate: p.endDate.toISOString()
                            })),
                            teamMembers: this.teamMembers,
                            nextTaskId: this.nextTaskId,
                            nextProjectId: this.nextProjectId,
                            nextMemberId: this.nextMemberId,
                            currentProjectId: this.currentProject?.id,
                            currentView: this.currentView,
                            theme: this.theme
                        };
                        localStorage.setItem('projectTimelineData', JSON.stringify(dataToSave));
                    } catch (error) {
                        console.error('保存数据失败:', error);
                    }
                },
                loadData() {
                    try {
                        const savedData = localStorage.getItem('projectTimelineData');
                        if (savedData) {
                            const data = JSON.parse(savedData);

                            // 恢复项目数据
                            this.projects = data.projects.map(p => ({
                                ...p,
                                startDate: new Date(p.startDate),
                                endDate: new Date(p.endDate),
                                tasks: p.tasks.map(t => ({
                                    ...t,
                                    startDate: new Date(t.startDate),
                                    endDate: new Date(t.endDate)
                                }))
                            }));

                            // 恢复团队成员
                            if (data.teamMembers && Array.isArray(data.teamMembers)) {
                                this.teamMembers = data.teamMembers;
                            }

                            // 恢复ID
                            this.nextTaskId = data.nextTaskId || 13;
                            this.nextProjectId = data.nextProjectId || 3;
                            this.nextMemberId = data.nextMemberId || 7;

                            // 恢复当前项目
                            if (data.currentProjectId) {
                                const project = this.projects.find(p => p.id === data.currentProjectId);
                                if (project) {
                                    this.currentProject = project;
                                }
                            } else {
                                this.currentProject = this.projects[0];
                            }

                            // 恢复视图
                            if (data.currentView) {
                                this.currentView = data.currentView;
                            }

                            // 恢复主题
                            if (data.theme) {
                                this.theme = data.theme;
                            }
                        }
                    } catch (error) {
                        console.error('加载数据失败:', error);
                        // 如果加载失败，使用默认数据
                        this.currentProject = this.projects[0];
                    }
                },
                autoSave() {
                    // 使用防抖保存
                    let saveTimer = null;

                    // 监听项目变化
                    this.$watch('projects', () => {
                        clearTimeout(saveTimer);
                        saveTimer = setTimeout(() => {
                            this.saveData();
                        }, 1000);
                    }, { deep: true });

                    // 监听当前项目变化
                    this.$watch('currentProject', () => {
                        clearTimeout(saveTimer);
                        saveTimer = setTimeout(() => {
                            this.saveData();
                        }, 1000);
                    }, { deep: true });
                },
                initializeIds() {
                    if (this.projects.length > 0) {
                        const maxTaskId = Math.max(...this.projects.flatMap(p => p.tasks.map(t => t.id || 0)));
                        const maxProjectId = Math.max(...this.projects.map(p => p.id || 0));
                        this.nextTaskId = Math.max(maxTaskId + 1, this.nextTaskId);
                        this.nextProjectId = Math.max(maxProjectId + 1, this.nextProjectId);
                    }
                    if (this.teamMembers.length > 0) {
                        const maxMemberId = Math.max(...this.teamMembers.map(m => m.id || 0));
                        this.nextMemberId = Math.max(maxMemberId + 1, this.nextMemberId);
                    }
                },
                // ========== 项目管理 ==========
                showProjectModal(project = null) {
                    console.log('=== showProjectModal被调用 ===', project);
                    console.log('当前isProjectModalVisible值:', this.isProjectModalVisible);
                    console.log('this对象:', this);

                    // 确保方法被正确调用
                    console.log('showProjectModal方法被调用！');

                    try {
                        if (project) {
                            // 编辑模式
                            console.log('编辑项目模式', project);
                            this.editingProject = project;
                            this.newProject = {
                                name: project.name,
                                startDate: this.formatDateForInput(project.startDate),
                                endDate: this.formatDateForInput(project.endDate),
                                description: project.description || ""
                            };
                        } else {
                            // 新建模式
                            console.log('新建项目模式');
                            this.editingProject = null;
                            const today = new Date();
                            const nextMonth = new Date(today);
                            nextMonth.setMonth(today.getMonth() + 3);
                            this.newProject = {
                                name: "",
                                startDate: this.formatDateForInput(today),
                                endDate: this.formatDateForInput(nextMonth),
                                description: ""
                            };
                        }

                        // 设置模态框显示状态
                        this.isProjectModalVisible = true;

                        console.log('isProjectModalVisible设置为true', this.isProjectModalVisible);
                        console.log('验证值:', this.isProjectModalVisible);

                        // 验证模态框是否应该显示
                        setTimeout(() => {
                            const modal = document.querySelector('.modal-overlay');
                            console.log('模态框元素:', modal);
                            if (!modal) {
                                console.error('模态框元素未找到！');
                            }
                        }, 100);

                    } catch (error) {
                        console.error('打开项目模态框失败:', error);
                        console.error('错误堆栈:', error.stack);
                        this.showToast('打开项目模态框失败: ' + error.message, 'error');
                    }
                },
                closeProjectModal() {
                    this.isProjectModalVisible = false;
                    this.editingProject = null;
                    this.newProject = {
                        name: "",
                        startDate: "",
                        endDate: "",
                        description: ""
                    };
                },
                saveProject() {
                    if (!this.newProject.name.trim()) {
                        this.showToast('请输入项目名称', 'error');
                        return;
                    }
                    if (!this.newProject.startDate || !this.newProject.endDate) {
                        this.showToast('请选择开始和结束日期', 'error');
                        return;
                    }

                    const startDate = new Date(this.newProject.startDate);
                    const endDate = new Date(this.newProject.endDate);

                    if (endDate < startDate) {
                        this.showToast('结束日期不能早于开始日期', 'error');
                        return;
                    }

                    if (this.editingProject) {
                        // 更新项目
                        Object.assign(this.editingProject, {
                            name: this.newProject.name,
                            startDate: startDate,
                            endDate: endDate,
                            description: this.newProject.description
                        });
                        this.showToast('项目已更新', 'success');
                    } else {
                        // 创建新项目
                        const newProject = {
                            id: this.nextProjectId++,
                            name: this.newProject.name,
                            startDate: startDate,
                            endDate: endDate,
                            description: this.newProject.description,
                            tasks: []
                        };
                        this.projects.push(newProject);
                        this.currentProject = newProject;
                        this.showToast('项目已创建', 'success');
                    }
                    this.saveData();
                    this.closeProjectModal();
                },
                deleteProject(project) {
                    console.log('deleteProject被调用', project);
                    try {
                        if (!project) {
                            this.showToast('请选择要删除的项目', 'error');
                            return;
                        }

                        if (confirm(`确定要删除项目"${project.name}"吗？这将删除项目下的所有任务！此操作无法撤销！`)) {
                            const index = this.projects.findIndex(p => p.id === project.id);
                            if (index > -1) {
                                this.projects.splice(index, 1);
                                if (this.currentProject && this.currentProject.id === project.id) {
                                    this.currentProject = this.projects[0] || null;
                                    this.selectedTask = this.currentProject?.tasks[0] || null;
                                }
                                this.showToast('项目已删除', 'success');
                                this.saveData();
                            } else {
                                this.showToast('项目不存在', 'error');
                            }
                        }
                    } catch (error) {
                        console.error('删除项目失败:', error);
                        this.showToast('删除项目失败: ' + error.message, 'error');
                    }
                },
                // ========== 搜索和筛选 ==========
                clearFilters() {
                    this.searchQuery = "";
                    this.filterStatus = "all";
                    this.filterPriority = "all";
                    this.filterAssignee = "all";
                    this.showToast('筛选条件已清除', 'success');
                },
                // ========== 主题切换 ==========
                loadTheme() {
                    document.documentElement.setAttribute('data-theme', this.theme);
                },
                toggleTheme() {
                    this.theme = this.theme === 'light' ? 'dark' : 'light';
                    this.loadTheme();
                    this.saveData();
                },
                // ========== 快捷键 ==========
                bindKeyboardShortcuts() {
                    document.addEventListener('keydown', (e) => {
                        // Ctrl/Cmd + N: 新建任务
                        if ((e.ctrlKey || e.metaKey) && e.key === 'n' && !e.shiftKey) {
                            e.preventDefault();
                            this.showTaskModal();
                        }
                        // Ctrl/Cmd + Shift + N: 新建项目
                        if ((e.ctrlKey || e.metaKey) && e.key === 'N') {
                            e.preventDefault();
                            this.showProjectModal();
                        }
                        // Ctrl/Cmd + F: 聚焦搜索
                        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                            e.preventDefault();
                            const searchInput = document.querySelector('.search-input');
                            if (searchInput) {
                                searchInput.focus();
                            }
                        }
                        // Escape: 关闭模态框
                        if (e.key === 'Escape') {
                            if (this.isTaskModalVisible) {
                                this.closeTaskModal();
                            }
                            if (this.isProjectModalVisible) {
                                this.closeProjectModal();
                            }
                            if (this.isMemberModalVisible) {
                                this.closeMemberModal();
                            }
                            if (this.showSettings) {
                                this.showSettings = false;
                            }
                        }
                    });
                },
                // ========== 批量操作 ==========
                toggleTaskSelection(task) {
                    const index = this.selectedTasks.findIndex(t => t.id === task.id);
                    if (index > -1) {
                        this.selectedTasks.splice(index, 1);
                    } else {
                        this.selectedTasks.push(task);
                    }
                    this.showBulkActions = this.selectedTasks.length > 0;
                },
                selectAllTasks() {
                    const filtered = this.filteredTasks();
                    this.selectedTasks = filtered.length === this.selectedTasks.length ? [] : [...filtered];
                    this.showBulkActions = this.selectedTasks.length > 0;
                },
                bulkDeleteTasks() {
                    const count = this.selectedTasks.length;
                    if (count === 0) {
                        this.showToast('请先选择任务', 'error');
                        return;
                    }

                    if (confirm(`确定要删除选中的 ${count} 个任务吗？此操作无法撤销！`)) {
                        const tasksToDelete = [...this.selectedTasks];
                        let deletedCount = 0;

                        tasksToDelete.forEach(task => {
                            const index = this.currentProject.tasks.findIndex(t => t.id === task.id);
                            if (index > -1) {
                                this.currentProject.tasks.splice(index, 1);
                                deletedCount++;

                                // 如果删除的是当前选中的任务，清除选中
                                if (this.selectedTask && this.selectedTask.id === task.id) {
                                    this.selectedTask = this.currentProject.tasks[0] || null;
                                }
                            }
                        });

                        this.selectedTasks = [];
                        this.showBulkActions = false;
                        this.showToast(`已删除 ${deletedCount} 个任务`, 'success');
                        this.saveData();
                    }
                },
                bulkUpdateStatus(status) {
                    if (this.selectedTasks.length === 0) {
                        this.showToast('请先选择任务', 'error');
                        return;
                    }
                    const count = this.selectedTasks.length;
                    const statusName = this.taskStatuses.find(s => s.id === status)?.name || status;

                    this.selectedTasks.forEach(task => {
                        task.status = status;
                    });

                    this.showToast(`已更新 ${count} 个任务的状态为"${statusName}"`, 'success');
                    this.selectedTasks = [];
                    this.showBulkActions = false;
                    this.saveData();
                    // 更新资源图表
                    this.$nextTick(() => {
                        if (this.currentView === 'resource') {
                            this.initResourceChart();
                        }
                    });
                },
                // ========== 全屏功能 ==========
                toggleFullscreen() {
                    const viewContainer = document.querySelector('.view-container');
                    if (!viewContainer) return;

                    if (!this.isFullscreen) {
                        // 进入全屏
                        if (viewContainer.requestFullscreen) {
                            viewContainer.requestFullscreen();
                        } else if (viewContainer.webkitRequestFullscreen) {
                            viewContainer.webkitRequestFullscreen();
                        } else if (viewContainer.mozRequestFullScreen) {
                            viewContainer.mozRequestFullScreen();
                        } else if (viewContainer.msRequestFullscreen) {
                            viewContainer.msRequestFullscreen();
                        }
                        this.isFullscreen = true;
                        this.fullscreenElement = viewContainer;
                        this.showToast('已进入全屏模式，按ESC退出', 'info');
                    } else {
                        // 退出全屏
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                        this.isFullscreen = false;
                        this.fullscreenElement = null;
                        this.showToast('已退出全屏模式', 'info');
                    }
                },
                // ========== 打印和导出 ==========
                printView() {
                    try {
                        const printContent = document.querySelector('.view-content');
                        if (!printContent) {
                            this.showToast('无法找到打印内容', 'error');
                            return;
                        }
                        window.print();
                        this.showToast('打印对话框已打开', 'success');
                    } catch (error) {
                        this.showToast('打印失败: ' + error.message, 'error');
                    }
                },
                exportToPDF() {
                    try {
                        // 使用浏览器打印功能转换为PDF
                        this.showToast('请使用打印功能，然后在打印对话框中选择"另存为PDF"', 'info');
                        setTimeout(() => {
                            this.printView();
                        }, 500);
                    } catch (error) {
                        this.showToast('导出失败: ' + error.message, 'error');
                    }
                },
                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.projects && Array.isArray(data.projects)) {
                                // 转换日期
                                data.projects = data.projects.map(p => ({
                                    ...p,
                                    startDate: new Date(p.startDate),
                                    endDate: new Date(p.endDate),
                                    tasks: p.tasks.map(t => ({
                                        ...t,
                                        startDate: new Date(t.startDate),
                                        endDate: new Date(t.endDate)
                                    }))
                                }));

                                // 合并项目
                                this.projects = [...this.projects, ...data.projects];
                                this.initializeIds();
                                this.showToast(`成功导入 ${data.projects.length} 个项目`, 'success');
                                this.saveData();
                            }
                        } catch (error) {
                            this.showToast('导入失败: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                },
                clearAllData() {
                    if (confirm('确定要清除所有数据吗？此操作无法撤销！')) {
                        localStorage.removeItem('projectTimelineData');
                        location.reload();
                    }
                },
                // ========== 负责人管理 ==========
                showMemberModal(member = null) {
                    if (member) {
                        // 编辑模式
                        this.editingMember = member;
                        this.newMember = {
                            name: member.name,
                            skills: [...(member.skills || [])]
                        };
                    } else {
                        // 新建模式
                        this.editingMember = null;
                        this.newMember = {
                            name: "",
                            skills: []
                        };
                    }
                    this.newSkill = "";
                    this.isMemberModalVisible = true;
                },
                closeMemberModal() {
                    this.isMemberModalVisible = false;
                    this.editingMember = null;
                    this.newMember = {
                        name: "",
                        skills: []
                    };
                    this.newSkill = "";
                },
                addSkill() {
                    if (this.newSkill.trim() && !this.newMember.skills.includes(this.newSkill.trim())) {
                        this.newMember.skills.push(this.newSkill.trim());
                        this.newSkill = "";
                    }
                },
                removeSkill(index) {
                    this.newMember.skills.splice(index, 1);
                },
                saveMember() {
                    if (!this.newMember.name.trim()) {
                        this.showToast('请输入负责人姓名', 'error');
                        return;
                    }

                    // 检查姓名是否重复（编辑时排除自己）
                    const existingMember = this.teamMembers.find(
                        m => m.name === this.newMember.name.trim() &&
                        (!this.editingMember || m.id !== this.editingMember.id)
                    );
                    if (existingMember) {
                        this.showToast('该姓名已存在', 'error');
                        return;
                    }

                    if (this.editingMember) {
                        // 更新现有负责人
                        Object.assign(this.editingMember, {
                            name: this.newMember.name.trim(),
                            skills: [...this.newMember.skills]
                        });
                        this.showToast('负责人已更新', 'success');
                    } else {
                        // 创建新负责人
                        const newMember = {
                            id: this.nextMemberId++,
                            name: this.newMember.name.trim(),
                            skills: [...this.newMember.skills],
                            load: 0
                        };
                        this.teamMembers.push(newMember);
                        this.showToast('负责人已创建', 'success');
                    }
                    this.saveData();
                    this.closeMemberModal();
                },
                deleteMember(member) {
                    // 检查是否有任务分配给该负责人
                    const hasTasks = this.projects.some(project =>
                        project.tasks.some(task => task.assignee === member.name)
                    );

                    if (hasTasks) {
                        this.showToast('该负责人还有分配的任务，无法删除', 'error');
                        return;
                    }

                    if (confirm(`确定要删除负责人"${member.name}"吗？`)) {
                        const index = this.teamMembers.findIndex(m => m.id === member.id);
                        if (index > -1) {
                            this.teamMembers.splice(index, 1);
                            this.showToast('负责人已删除', 'success');
                            this.saveData();
                        }
                    }
                }
            }
            });

            // 确保Vue正确挂载
            try {
                const app = VueApp.mount('#app');

                // 添加全局调试
                window.app = app;
                window.VueApp = VueApp;
                console.log('Vue应用已挂载', app);
                console.log('Vue实例方法:', Object.keys(app));
                console.log('showProjectModal方法:', typeof app.showProjectModal);
                console.log('showTaskModal方法:', typeof app.showTaskModal);
                console.log('isProjectModalVisible属性:', typeof app.isProjectModalVisible);
                console.log('isTaskModalVisible属性:', typeof app.isTaskModalVisible);

                // 测试方法是否可访问
                if (typeof app.showProjectModal === 'function') {
                    console.log('✓ showProjectModal方法存在');
                } else {
                    console.error('✗ showProjectModal方法不存在！');
                }

                if (typeof app.showTaskModal === 'function') {
                    console.log('✓ showTaskModal方法存在');
                } else {
                    console.error('✗ showTaskModal方法不存在！');
                }

                // 添加测试按钮事件监听
                setTimeout(() => {
                    const newProjectBtn = document.querySelector('[title="创建新项目"]');
                    const addTaskBtn = document.querySelector('[title="添加新任务"]');

                    if (newProjectBtn) {
                        console.log('找到新建项目按钮');
                        newProjectBtn.addEventListener('click', function(e) {
                            console.log('新建项目按钮被点击（原生事件）');
                        });
                    } else {
                        console.error('未找到新建项目按钮！');
                    }

                    if (addTaskBtn) {
                        console.log('找到添加任务按钮');
                        addTaskBtn.addEventListener('click', function(e) {
                            console.log('添加任务按钮被点击（原生事件）');
                        });
                    } else {
                        console.error('未找到添加任务按钮！');
                    }
                }, 1000);

            } catch (error) {
                console.error('Vue挂载失败:', error);
                alert('Vue应用挂载失败: ' + error.message);
            }
        }

        // 开始检查Vue是否加载
        checkVueLoaded();
    </script>
</body>
</html>
